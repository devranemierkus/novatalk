<!DOCTYPE html><html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>NovaTalk - Sesli & Görüntülü Sohbet + Nesne Tanıma</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
    }
    button {
      font-size: 16px;
      margin: 10px;
      padding: 10px 20px;
      border-radius: 10px;
      border: none;
      background-color: #4caf50;
      color: white;
      cursor: pointer;
    }
    video, canvas {
      margin-top: 20px;
      width: 300px;
      border-radius: 12px;
    }
    #log {
      background: #222;
      padding: 10px;
      margin-top: 20px;
      border-radius: 10px;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
      white-space: pre-wrap;
    }
    #guvenlik {
      margin-top: 30px;
      font-size: 14px;
      color: #aaa;
      border-top: 1px solid #444;
      padding-top: 20px;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }
  </style>
</head>
<body><h1>NovaTalk 🤖</h1>
<button onclick="temaDegistir()">🎨 Tema Değiştir</button>
<button onclick="baslatSesli()">🎤 Sesli Konuş</button>
<button onclick="durdurSesli()">🛑 Konuşmayı Durdur</button>
<button onclick="baslatGoruntu()">🎥 Görüntü + Nesne Tanıma</button>
<button onclick="durdurGoruntu()">📴 Görüntüğü Durdur</button><video id="video" autoplay muted playsinline></video> <canvas id="canvas"></canvas>

<div id="log">📝 Konuşma logu buraya gelecek...</div>
<div id="guvenlik">
  🔒 <strong>Güvenlik Bilgisi:</strong><br>
  NovaTalk cihaz üzerinde çalışır. Ses ve görüntüler kaydedilmez veya gönderilmez.<br>
  Kimse sizi izleyemez ya da dinleyemez. Tamamen gizlidir.
</div><script>
let recognition, model, ctx, videoStream;
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
ctx = canvas.getContext('2d');
const log = document.getElementById('log');

function botKonus(text) {
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = 'tr-TR';
  speechSynthesis.speak(utter);
}

function logla(yazi) {
  log.textContent += `\n${yazi}`;
  log.scrollTop = log.scrollHeight;
}

function baslatSesli() {
  navigator.mediaDevices.getUserMedia({ audio: true }).then(() => {
    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SR();
    recognition.lang = 'tr-TR';
    recognition.continuous = true;

    recognition.onresult = e => {
      const text = e.results[e.results.length - 1][0].transcript;
      logla('👤: ' + text);
      botCevapla(text);
    };
    recognition.start();
    botKonus('Selam! Ben ChatNova. Seni dinliyorum...');
  }).catch(() => alert('Mikrofon izni gerek!'));
}

function durdurSesli() {
  if (recognition) recognition.stop();
  botKonus('Konuşma durduruldu.');
}

function botCevapla(text) {
  let cevap = '';
  const lower = text.toLowerCase();
  if (lower.includes('merhaba')) cevap = 'Merhaba! Sana nasıl yardımcı olabilirim?';
  else if (lower.includes('nasılsın')) cevap = 'İyiyim, sen nasılsın?';
  else if (lower.includes('görüşürüz')) cevap = 'Görüşmek üzere!';
  else cevap = 'Bunu tam anlayamadım, tekrar eder misin?';
  botKonus(cevap);
  logla('🤖 ChatNova: ' + cevap);
}

function baslatGoruntu() {
  navigator.mediaDevices.getUserMedia({ video: true, audio: true }).then(stream => {
    video.srcObject = stream;
    videoStream = stream;
    video.style.display = 'block';
    canvas.width = video.videoWidth || 300;
    canvas.height = video.videoHeight || 300;
    tf.loadGraphModel;
    cocoSsd.load().then(m => {
      model = m;
      tanimayaBasla();
    });
  }).catch(() => alert('Kamera izni gerek!'));
}

function tanimayaBasla() {
  function loop() {
    if (!videoStream) return;
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    model.detect(video).then(predictions => {
      predictions.forEach(p => {
        ctx.beginPath();
        ctx.rect(...p.bbox);
        ctx.lineWidth = 2;
        ctx.strokeStyle = '#00FF00';
        ctx.fillStyle = '#00FF00';
        ctx.stroke();
        ctx.fillText(p.class, p.bbox[0], p.bbox[1] > 10 ? p.bbox[1] - 5 : 10);
      });
    });
    requestAnimationFrame(loop);
  }
  loop();
}

function durdurGoruntu() {
  if (videoStream) {
    videoStream.getTracks().forEach(t => t.stop());
    videoStream = null;
    video.style.display = 'none';
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }
}

function temaDegistir() {
  const bg = document.body.style.background;
  document.body.style.background = bg === 'white' ? '#111' : 'white';
  document.body.style.color = bg === 'white' ? '#eee' : 'black';
}
</script></body>
</html>
