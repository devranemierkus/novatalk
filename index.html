<!DOCTYPE html><html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NovaTalk - ChatNova</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #e6e6e6;
      color: #333;
    }
    header {
      background: #075e54;
      color: white;
      text-align: center;
      padding: 14px;
      font-size: 22px;
    }
    #callScreen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 70vh;
      text-align: center;
    }
    #spinner {
      border: 6px solid rgba(255,255,255,0.3);
      border-top: 6px solid #075e54;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    #avatar {
      width: 140px;
      height: 140px;
      border-radius: 50%;
      background: url('https://i.ibb.co/KsC1cx4/avatar.png') center/cover;
      margin-bottom: 20px;
      animation: blink 5s infinite;
    }
    @keyframes blink {
      0%, 100% { filter: none; }
      50% { filter: brightness(90%); }
    }
    #video {
      width: 80%;
      max-width: 400px;
      border-radius: 12px;
      margin-top: 10px;
      display: none;
    }
    #log {
      background: #fff;
      margin: 10px;
      padding: 10px;
      border-radius: 8px;
      height: 120px;
      overflow-y: auto;
      font-size: 14px;
      white-space: pre-wrap;
    }
    footer {
      display: flex;
      justify-content: space-around;
      padding: 12px;
      background: #f0f0f0;
    }
    button {
      padding: 10px 20px;
      font-size: 15px;
      border: none;
      border-radius: 25px;
      cursor: pointer;
    }
    #startAudioBtn { background: #25d366; color: white; }
    #startVideoBtn { background: #34b7f1; color: white; }
    #endCallBtn { background: #dc3545; color: white; display: none; }
    #status { font-size: 18px; margin-top: 10px; color: #075e54; }
    #warning { font-size: 13px; color: gray; text-align: center; margin-top: 8px; }
  </style>
</head>
<body>  <header>NovaTalk - ChatNova</header>
  <div id="callScreen">
    <div id="spinner"></div>
    <div id="avatar"></div>
    <div id="status">ChatNova aranƒ±yor...</div>
    <video id="video" autoplay playsinline muted></video>
  </div>  <div id="log">üìù Konu≈üma ge√ßmi≈üi buraya yazƒ±lacak...</div>
  <div id="warning">üîí Bu konu≈üma g√ºvenlidir. Kimse sizi izleyemez, dinleyemez.</div>  <footer>
    <button id="startAudioBtn">üé§ Sesli Arama</button>
    <button id="startVideoBtn">üìπ G√∂r√ºnt√ºl√º Arama</button>
    <button id="endCallBtn">üî¥ Kapat</button>
  </footer>  <script>
    const startAudioBtn = document.getElementById('startAudioBtn');
    const startVideoBtn = document.getElementById('startVideoBtn');
    const endCallBtn = document.getElementById('endCallBtn');
    const status = document.getElementById('status');
    const spinner = document.getElementById('spinner');
    const video = document.getElementById('video');
    const log = document.getElementById('log');
    const avatar = document.getElementById('avatar');

    let audioStream, videoStream, recognition, inactivityTimer;
    let isCalling = false, introSaid = false;

    function speak(text) {
      try {
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = 'tr-TR';
        speechSynthesis.speak(utter);
        avatar.style.filter = 'contrast(130%)';
        setTimeout(() => avatar.style.filter = '', 2000);
      } catch {
        console.error('Sesli yanƒ±t verilemedi.');
      }
    }

    function logMessage(text) {
      log.textContent += `\n${text}`;
      log.scrollTop = log.scrollHeight;
    }

    function resetInactivity() {
      clearTimeout(inactivityTimer);
      inactivityTimer = setTimeout(() => {
        speak('Dostum, konu≈ümuyorsun. Kapatmak zorundayƒ±m.');
        endCall();
      }, 15000);
    }

    function startRecognition() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SpeechRecognition();
      recognition.lang = 'tr-TR';
      recognition.interimResults = false;

      recognition.onstart = () => {
        if (!introSaid) {
          speak('Selam, seni dinliyorum.');
          introSaid = true;
        }
      };

      recognition.onresult = e => {
        const userText = e.results[0][0].transcript;
        logMessage('üë§ Sen: ' + userText);
        botReply(userText);
        resetInactivity();
      };

      recognition.onend = () => {
        if (isCalling) recognition.start();
      };

      recognition.onerror = () => {
        logMessage('‚ö†Ô∏è Ses tanƒ±ma hatasƒ±.');
      };

      recognition.start();
    }

    function botReply(input) {
      let cevap = 'Anladƒ±m, bunu not ettim.';
      if (input.toLowerCase().includes('merhaba')) cevap = 'Merhaba! Size nasƒ±l yardƒ±mcƒ± olabilirim?';
      else if (input.toLowerCase().includes('nasƒ±lsƒ±n')) cevap = 'ƒ∞yiyim, te≈üekk√ºr ederim! Sen nasƒ±lsƒ±n?';
      else if (input.toLowerCase().includes('g√∂r√º≈ü√ºr√ºz')) {
        cevap = 'G√∂r√º≈ümek √ºzere!';
        setTimeout(endCall, 2000);
      }
      logMessage('ü§ñ ChatNova: ' + cevap);
      speak(cevap);
    }

    function startCall(withVideo = false) {
      isCalling = true;
      introSaid = false;
      spinner.style.display = 'block';
      status.textContent = 'ChatNova aranƒ±yor...';
      startAudioBtn.style.display = 'none';
      startVideoBtn.style.display = 'none';
      endCallBtn.style.display = 'inline-block';

      setTimeout(() => {
        status.textContent = 'G√∂r√º≈üme ba≈üladƒ±';
        spinner.style.display = 'none';

        const constraints = withVideo ? { audio: true, video: true } : { audio: true };
        navigator.mediaDevices.getUserMedia(constraints)
          .then(stream => {
            audioStream = stream;
            if (withVideo) {
              videoStream = stream;
              video.srcObject = stream;
              video.style.display = 'block';
            }
            startRecognition();
          })
          .catch(err => {
            logMessage('üö´ Eri≈üim reddedildi: ' + err.message);
            endCall();
          });
      }, 4000);
    }

    function endCall() {
      isCalling = false;
      introSaid = false;
      clearTimeout(inactivityTimer);
      if (recognition) recognition.stop();
      if (audioStream) audioStream.getTracks().forEach(t => t.stop());
      if (videoStream) videoStream.getTracks().forEach(t => t.stop());
      video.style.display = 'none';
      startAudioBtn.style.display = 'inline-block';
      startVideoBtn.style.display = 'inline-block';
      endCallBtn.style.display = 'none';
      status.textContent = 'G√∂r√º≈üme sonlandƒ±rƒ±ldƒ±';
    }

    startAudioBtn.onclick = () => startCall(false);
    startVideoBtn.onclick = () => startCall(true);
    endCallBtn.onclick = () => endCall();
  </script></body>
</html>
