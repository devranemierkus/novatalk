<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>NovaTalk - Sesli & G√∂r√ºnt√ºl√º Konu≈üma</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #121212;
      color: #eee;
      text-align: center;
      padding: 30px;
    }
    h1 {
      color: #4caf50;
      margin-bottom: 20px;
    }
    button {
      font-size: 18px;
      margin: 12px 10px;
      padding: 14px 28px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s ease;
      min-width: 160px;
      color: white;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    #btnVoice {
      background: #2196f3;
    }
    #btnVoice:hover {
      background: #1769aa;
    }
    #btnVideoStart {
      background: #ff9800;
      color: #222;
    }
    #btnVideoStart:hover {
      background: #cc7a00;
    }
    #btnVideoStop {
      background: #f44336;
    }
    #btnVideoStop:hover {
      background: #b71c1c;
    }
    video {
      margin-top: 25px;
      border-radius: 16px;
      max-width: 360px;
      width: 90%;
      display: none;
      border: 3px solid #4caf50;
      box-shadow: 0 0 15px #4caf50;
    }
    #status {
      margin-top: 18px;
      font-size: 18px;
      min-height: 28px;
    }
    #log {
      margin: 20px auto 0 auto;
      background: #222;
      padding: 16px;
      max-width: 360px;
      border-radius: 14px;
      white-space: pre-wrap;
      height: 140px;
      overflow-y: auto;
      font-size: 16px;
      color: #eee;
      border: 2px solid #4caf50;
      box-shadow: inset 0 0 10px #333;
    }
  </style>
</head>
<body>

  <h1>NovaTalk ü§ñ</h1>

  <button id="btnVoice">üé§ Sesli Konu≈ümayƒ± Ba≈ülat</button>
  <button id="btnVideoStart">üìπ G√∂r√ºnt√ºl√º Konu≈ümayƒ± Ba≈ülat</button>
  <button id="btnVideoStop" disabled>‚èπÔ∏è G√∂r√ºnt√ºl√º Konu≈ümayƒ± Durdur</button>

  <video id="video" autoplay playsinline></video>

  <div id="status">Durum: Bekleniyor...</div>
  <div id="log">üìù Konu≈üma logu buraya gelecek...</div>

  <script>
    const btnVoice = document.getElementById('btnVoice');
    const btnVideoStart = document.getElementById('btnVideoStart');
    const btnVideoStop = document.getElementById('btnVideoStop');
    const video = document.getElementById('video');
    const status = document.getElementById('status');
    const log = document.getElementById('log');

    let recognition = null;
    let audioStream = null;
    let videoStream = null;
    let listening = false;

    // Idle (bo≈üta) uyarƒ± timer
    let idleTimer = null;
    const idleTimeout = 5000; // 5 saniye

    function resetIdleTimer() {
      if (idleTimer) clearTimeout(idleTimer);
      idleTimer = setTimeout(() => {
        botKonus('Konu≈ü, bekliyorum dostum üòä');
        log.textContent += '\nü§ñ Bot: Konu≈ü, bekliyorum dostum üòä';
        log.scrollTop = log.scrollHeight;
        resetIdleTimer(); // tekrar ba≈ülat
      }, idleTimeout);
    }

    // Text-to-Speech bot fonksiyonu
    function botKonus(text) {
      if (speechSynthesis.speaking) {
        speechSynthesis.cancel();
      }
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'tr-TR';
      utterance.pitch = 1.1;
      utterance.rate = 1;
      speechSynthesis.speak(utterance);
    }

    // Sesli konu≈ümayƒ± ba≈ülat / s√ºrekli dinle
    btnVoice.onclick = () => {
      if (listening) {
        stopRecognition();
        btnVoice.textContent = 'üé§ Sesli Konu≈ümayƒ± Ba≈ülat';
        status.textContent = 'Durum: Sesli konu≈üma durduruldu.';
        if (idleTimer) clearTimeout(idleTimer);
        return;
      }

      navigator.mediaDevices.getUserMedia({ audio: true })
        .then(stream => {
          audioStream = stream;
          recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
          recognition.lang = 'tr-TR';
          recognition.interimResults = false;
          recognition.continuous = true;

          recognition.onresult = (event) => {
            resetIdleTimer(); // Kullanƒ±cƒ± konu≈ütu, timer sƒ±fƒ±rla
            const speech = event.results[event.results.length -1][0].transcript.toLowerCase();
            log.textContent += `\nüë§ Sen: ${speech}`;
            log.scrollTop = log.scrollHeight;
            botCevapVer(speech);
          };

          recognition.onerror = (event) => {
            status.textContent = `‚ö†Ô∏è Ses tanƒ±ma hatasƒ±: ${event.error}`;
          };

          recognition.onend = () => {
            if(listening) recognition.start();
            else status.textContent = 'Durum: Sesli konu≈üma kapandƒ±.';
          };

          recognition.start();
          resetIdleTimer();
          listening = true;
          btnVoice.textContent = 'üõë Sesli Konu≈ümayƒ± Durdur';
          status.textContent = 'Durum: Mikrofon aktif, seni dinliyorum...';
          log.textContent = 'üìù Konu≈üma logu ba≈ülatƒ±ldƒ±.';
        })
        .catch(err => {
          status.textContent = '‚ùå Mikrofon izni reddedildi veya hata: ' + err.message;
        });
    };

    // G√∂r√ºnt√ºl√º konu≈ümayƒ± ba≈ülat
    btnVideoStart.onclick = () => {
      navigator.mediaDevices.getUserMedia({ video: true, audio: true })
        .then(stream => {
          videoStream = stream;
          video.srcObject = stream;
          video.style.display = 'block';

          btnVideoStart.disabled = true;
          btnVideoStop.disabled = false;

          status.textContent = 'Durum: Kamera ve mikrofon a√ßƒ±k, g√∂r√ºnt√ºl√º konu≈üma ba≈üladƒ±.';
          log.textContent += '\nüìπ G√∂r√ºnt√ºl√º konu≈üma ba≈üladƒ±.';
        })
        .catch(err => {
          status.textContent = '‚ùå Kamera veya mikrofon izni reddedildi: ' + err.message;
        });
    };

    // G√∂r√ºnt√ºl√º konu≈ümayƒ± durdur
    btnVideoStop.onclick = () => {
      if (videoStream) {
        videoStream.getTracks().forEach(track => track.stop());
        video.srcObject = null;
        video.style.display = 'none';
        btnVideoStart.disabled = false;
        btnVideoStop.disabled = true;

        status.textContent = 'Durum: G√∂r√ºnt√ºl√º konu≈üma durduruldu.';
        log.textContent += '\n‚èπÔ∏è G√∂r√ºnt√ºl√º konu≈üma durduruldu.';
      }
    };

    // Botun basit cevap fonksiyonu
    function botCevapVer(sozcuk) {
      let cevap = '';
      if (sozcuk.includes('nasƒ±lsƒ±n')) cevap = 'ƒ∞yiyim, te≈üekk√ºr ederim! Sen nasƒ±lsƒ±n? üòä';
      else if (sozcuk.includes('merhaba')) cevap = 'Merhaba! Sana nasƒ±l yardƒ±mcƒ± olabilirim? ü§ñ';
      else if (sozcuk.includes('g√∂r√º≈ü√ºr√ºz')) {
        cevap = 'G√∂r√º≈ümek √ºzere! ƒ∞yi g√ºnler! üëã';
        stopRecognition();
      }
      else cevap = '√úzg√ºn√ºm, bunu anlayamadƒ±m. L√ºtfen tekrar eder misin? ü§î';

      log.textContent += `\nü§ñ Bot: ${cevap}`;
      log.scrollTop = log.scrollHeight;
      botKonus(cevap);
    }

    // Ses tanƒ±mayƒ± durdur
    function stopRecognition() {
      listening = false;
      if (recognition) {
        recognition.stop();
        recognition = null;
      }
      if (audioStream) {
        audioStream.getTracks().forEach(track => track.stop());
        audioStream = null;
      }
      status.textContent = 'Durum: Sesli konu≈üma kapandƒ±.';
      if (idleTimer) clearTimeout(idleTimer);
    }
  </script>

</body>
</html>
